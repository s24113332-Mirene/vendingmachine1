<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Travel Vending Machine</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

<style>
  :root{
    --mid:#0b4fa8;
    --blue:#1e88e5;
    --sky:#4fc3f7;
    --ink:#061a2f;
    --shadow: rgba(0,0,0,0.18);
    --good: rgba(34,197,94,0.55);
  }

  html, body { height: 100%; }
  body{
    margin:0;
    height: 100vh;
    overflow: hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:'Poppins',sans-serif;
    position:relative;

    /* ‚úÖ DARKENED a bit so it doesn't match the vending machine */
    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(79,195,247,0.18), transparent 60%),
      radial-gradient(1100px 700px at 85% 35%, rgba(30,136,229,0.16), transparent 62%),
      linear-gradient(180deg, #08325e 0%, #0a4a88 55%, #08325e 100%);
  }

  /* map stays visible */
  body::before{
    content:"";
    position:fixed;
    inset:0;
    background-image:url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/World_map_-_low_resolution.svg/1200px-World_map_-_low_resolution.svg.png');
    background-size:cover;
    background-position:center;
    background-repeat:no-repeat;
    opacity:0.24; /* slightly stronger for visibility */
    filter: hue-rotate(190deg) saturate(1.25) contrast(1.02);
    transform: scale(1.02);
    pointer-events:none;
    z-index:0;
  }

  /* ‚úÖ darker veil overlay (still light enough to see map) */
  body::after{
    content:"";
    position:fixed;
    inset:0;
    background:
      radial-gradient(900px 520px at 50% 35%, rgba(234,246,255,0.08), transparent 70%),
      linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.20));
    backdrop-filter: blur(1px);
    pointer-events:none;
    z-index:1;
  }

  /* Background animations */
  .sky-layer{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:2;
    overflow:hidden;
  }

  /* moving clouds */
  .cloud{
    position:absolute;
    width: clamp(220px, 24vw, 460px);
    height: clamp(90px, 9vw, 170px);
    border-radius: 999px;
    background:
      radial-gradient(circle at 30% 55%, rgba(234,246,255,0.38), transparent 55%),
      radial-gradient(circle at 60% 45%, rgba(234,246,255,0.32), transparent 58%),
      radial-gradient(circle at 45% 65%, rgba(234,246,255,0.36), transparent 60%);
    filter: blur(2px);
    opacity: 0.55;
    animation: cloudDrift linear infinite;
  }
  .cloud.c1{ top: 8%;  left: -35%; animation-duration: 34s; animation-delay:-8s; transform: scale(1.05); }
  .cloud.c2{ top: 22%; left: -50%; animation-duration: 42s; animation-delay:-18s; opacity:0.46; transform: scale(0.9); }
  .cloud.c3{ top: 54%; left: -45%; animation-duration: 38s; animation-delay:-12s; opacity:0.50; transform: scale(1.18); }
  .cloud.c4{ top: 74%; left: -55%; animation-duration: 46s; animation-delay:-25s; opacity:0.40; transform: scale(0.85); }

  @keyframes cloudDrift{
    0%   { transform: translateX(-160px) translateY(0) scale(1); }
    50%  { transform: translateX(55vw) translateY(-10px) scale(1); }
    100% { transform: translateX(calc(100vw + 520px)) translateY(0) scale(1); }
  }

  /* ‚úÖ Planes with LOOP motion (circular/elliptical) */
  .loop-wrap{
    position:fixed;
    inset:0;
    z-index:2;
    pointer-events:none;
  }

  .loop{
    position:absolute;
    left:50%;
    top:50%;
    width: 120vmax;
    height: 80vmax;
    transform: translate(-50%,-50%) rotate(-10deg);
    opacity: 0.9;
  }
  .loop .orbit{
    position:absolute;
    inset:0;
    animation: spin 18s linear infinite;
  }
  .loop .orbit.slow{ animation-duration: 28s; opacity:0.75; }
  .loop .orbit.slower{ animation-duration: 40s; opacity:0.55; }
  .loop .orbit.reverse{ animation-direction: reverse; }

  .loop .plane{
    position:absolute;
    left:50%;
    top: 0%;
    transform: translate(-50%, -50%);
    font-size: clamp(40px, 4.4vw, 82px);
    opacity: 0.85;
    filter: drop-shadow(0 18px 28px rgba(0,0,0,0.26));
  }

  @keyframes spin{
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }

  .mini-loop{
    position:absolute;
    width: 34vmax;
    height: 24vmax;
    opacity:0.62;
  }
  .mini-loop .orbit{ animation: spin 14s linear infinite; }
  .mini-loop .plane{ font-size: clamp(28px, 3.2vw, 58px); }

  .ml1{ left: 15%; top: 20%; transform: translate(-50%,-50%) rotate(12deg); }
  .ml2{ left: 82%; top: 28%; transform: translate(-50%,-50%) rotate(-18deg); }
  .ml3{ left: 25%; top: 78%; transform: translate(-50%,-50%) rotate(-8deg); }
  .ml4{ left: 78%; top: 78%; transform: translate(-50%,-50%) rotate(10deg); }

  /* vending machine */
  .vending-container{
    width: min(980px, 94vw);
    max-height: 92vh;
    padding: clamp(14px, 2vh, 24px);
    border-radius: 30px;
    color: #fff;
    position:relative;
    z-index:5;
    overflow:hidden;
    background:
      radial-gradient(900px 500px at 12% 0%, rgba(79,195,247,0.28), transparent 55%),
      linear-gradient(145deg, #0a2a4a 0%, #0b4fa8 50%, #4fc3f7 100%);
    border: 6px solid rgba(125, 211, 252, 0.55);
    box-shadow: 0 22px 70px rgba(0,0,0,0.22), 0 0 60px rgba(79,195,247,0.18);
  }

  .vending-container::before{
    content:'';
    position:absolute;
    top:-46px;
    left:50%;
    transform:translateX(-50%);
    width: 170px;
    height: 40px;
    background: linear-gradient(90deg, rgba(79,195,247,0.95), rgba(30,136,229,0.95));
    border-radius: 22px 22px 0 0;
    box-shadow: 0 12px 20px rgba(0,0,0,0.18);
    border: 3px solid rgba(234,246,255,0.25);
    z-index:3;
  }

  .shine{
    position:absolute;
    inset:-40% -20% auto -30%;
    height: 70%;
    background: linear-gradient(120deg, rgba(255,255,255,0.14), rgba(255,255,255,0) 55%);
    transform: rotate(12deg);
    pointer-events:none;
    z-index:0;
  }

  /* ‚úÖ travel emojis inside machine */
  .inner-stickers{
    position:absolute;
    inset:0;
    pointer-events:none;
    z-index:1;
    opacity:0.22;
  }
  .inner-stickers span{
    position:absolute;
    font-size: clamp(26px, 3vw, 56px);
    transform: rotate(var(--r, 0deg));
    filter: drop-shadow(0 12px 20px rgba(0,0,0,0.18));
  }
  .st1{ top: 10%; left: 5%;   --r:-14deg; }
  .st2{ top: 18%; right: 8%;  --r:10deg; }
  .st3{ top: 42%; left: 8%;   --r:12deg; }
  .st4{ top: 42%; right: 10%; --r:-10deg; }
  .st5{ bottom: 18%; left: 16%; --r:8deg; }
  .st6{ bottom: 22%; right: 18%; --r:-12deg; }
  .st7{ top: 62%; left: 46%;  --r:6deg; }
  .st8{ top: 26%; left: 48%;  --r:-8deg; }

  .header{
    position:relative;
    z-index:4;
    text-align:center;
    padding: 12px 14px;
    border-radius: 16px;
    background: linear-gradient(90deg, rgba(234,246,255,0.14), rgba(79,195,247,0.14), rgba(234,246,255,0.08));
    border: 1px solid rgba(234,246,255,0.20);
    box-shadow: 0 0 18px rgba(79,195,247,0.14);
    margin-bottom: 10px;
  }
  .header h1{
    margin:0;
    font-family:'Playfair Display', serif;
    font-size: clamp(18px, 2.4vw, 28px);
    letter-spacing: 0.4px;
  }
  .header p{
    margin:6px 0 0;
    font-weight:700;
    opacity:0.95;
    font-size: clamp(12px, 1.4vw, 14px);
  }

  /* display panel (tinted blue) */
  .screen{
    position:relative;
    z-index:4;
    width: min(820px, 100%);
    margin: 0 auto 10px;
    padding: 14px 16px;
    border-radius: 20px;
    color: #eaf6ff;
    text-align:center;

    background:
      radial-gradient(900px 260px at 18% 0%, rgba(255,255,255,0.18), rgba(255,255,255,0) 60%),
      linear-gradient(135deg,
        rgba(7,42,86,0.92) 0%,
        rgba(11,79,168,0.88) 45%,
        rgba(79,195,247,0.34) 100%);
    border: 1px solid rgba(234,246,255,0.22);
    box-shadow:
      0 16px 38px rgba(0,0,0,0.16),
      0 0 34px rgba(79,195,247,0.18),
      inset 0 0 0 1px rgba(255,255,255,0.10);
    backdrop-filter: blur(10px);
    overflow:hidden;
  }
  .screen::before{
    content:"";
    position:absolute;
    inset:0;
    background: linear-gradient(115deg, rgba(255,255,255,0.12), rgba(255,255,255,0) 60%);
    opacity:0.85;
    pointer-events:none;
  }

  /* ‚úÖ emojis inside the display panel (your screenshot area) */
  .screen-emojis{
    position:absolute;
    inset:0;
    pointer-events:none;
    z-index:1;
    opacity:0.20;
  }
  .screen-emojis span{
    position:absolute;
    left: var(--x);
    top: var(--y);
    transform: rotate(var(--r)) scale(0.95);
    font-size: clamp(16px, 1.8vw, 22px);
    filter: drop-shadow(0 10px 16px rgba(0,0,0,0.25));
    animation: emojiFloat 3.8s ease-in-out infinite;
    animation-delay: var(--d);
  }
  @keyframes emojiFloat{
    0%,100% { transform: translateY(0) rotate(var(--r)) scale(0.95); opacity:0.75; }
    50%     { transform: translateY(-8px) rotate(var(--r)) scale(1.02); opacity:1; }
  }

  .screen p{
    margin: 6px 0;
    font-weight:800;
    position:relative;
    z-index:2; /* above panel emojis */
    font-size: clamp(12px, 1.35vw, 14px);
  }
  #balance{ color: #bfe6ff; font-size: clamp(16px, 1.8vw, 20px); font-weight:900; }
  #inserted-coins{ color: #7dd3fc; font-style: italic; font-weight:800; }
  #message{ white-space: pre-line; }

  /* overlay messages */
  .center-message{
    pointer-events:none;
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%) scale(0.86);
    opacity:0;
    text-align:center;
    font-weight:900;
    letter-spacing: 0.8px;
    font-size: clamp(16px, 2vw, 22px);
    z-index:5;
    padding: 12px 22px;
    border-radius: 18px;
    text-shadow: 0 12px 22px rgba(0,0,0,0.22);
    box-shadow: 0 0 28px rgba(255,255,255,0.25);
    filter: drop-shadow(0 18px 30px rgba(0,0,0,0.18));
  }
  .center-message.show{ animation: popGlow 1.35s ease forwards; }
  @keyframes popGlow{
    0%   { opacity:0; transform: translate(-50%, -50%) scale(0.82); }
    16%  { opacity:1; transform: translate(-50%, -50%) scale(1.06); }
    36%  { transform: translate(-50%, -50%) scale(0.98); }
    62%  { transform: translate(-50%, -50%) scale(1.02); }
    100% { opacity:0; transform: translate(-50%, -50%) scale(1.00); }
  }
  #dispense-msg{ background: linear-gradient(45deg, rgba(30,136,229,0.95), rgba(79,195,247,0.95)); color:#fff; border:1px solid rgba(234,246,255,0.25); }
  #success-msg{ background: linear-gradient(45deg, rgba(34,197,94,0.92), rgba(125,211,252,0.92)); color:#06213a; border:1px solid rgba(234,246,255,0.25); }
  #error-msg{ background: linear-gradient(45deg, rgba(239,68,68,0.92), rgba(245,158,11,0.92)); color:#061a2f; border:1px solid rgba(234,246,255,0.25); }

  .coin-section{ position:relative; z-index:4; text-align:center; }
  .coin-section h3{ margin: 8px 0 8px; font-weight:900; font-size: clamp(12px, 1.4vw, 14px); }
  .coin-buttons{
    display:flex;
    justify-content:center;
    gap: 10px;
    flex-wrap:wrap;
  }
  .coin-buttons button{
    font-weight:900;
    font-size: clamp(12px, 1.35vw, 14px);
    padding: 10px 14px;
    border-radius: 12px;
    border: 1px solid rgba(234,246,255,0.32);
    cursor:pointer;
    color:#06213a;
    background: linear-gradient(45deg, rgba(234,246,255,0.92), rgba(125,211,252,0.90));
    box-shadow: 0 10px 22px rgba(0,0,0,0.14), 0 0 30px rgba(79,195,247,0.18);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .coin-buttons button:hover{
    transform: translateY(-2px) scale(1.04);
    box-shadow:0 16px 30px rgba(0,0,0,0.18), 0 0 42px rgba(79,195,247,0.22);
  }

  .product-section{
    position:relative;
    z-index:4;
    display:grid;
    grid-template-columns: repeat(4, minmax(0,1fr));
    gap: 10px;
    margin-top: 10px;
  }
  @media (max-width: 900px){ .product-section{ grid-template-columns: repeat(3, 1fr); } }
  @media (max-width: 680px){ .product-section{ grid-template-columns: repeat(2, 1fr); } }

  .product{
    position:relative;
    border-radius: 14px;
    padding: 10px;
    text-align:center;
    user-select:none;
    overflow:hidden;
    cursor:not-allowed;
    border: 1px solid rgba(234,246,255,0.20);
    background:
      radial-gradient(280px 160px at 20% 0%, rgba(255,255,255,0.16), transparent 55%),
      linear-gradient(180deg, rgba(234,246,255,0.12), rgba(125,211,252,0.08));
    box-shadow: inset 0 0 0 2px rgba(11,42,74,0.10), 0 10px 18px rgba(0,0,0,0.14);
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, opacity .18s ease, filter .18s ease;
    min-height: 130px;
  }
  .product.enabled{ cursor:pointer; }
  .product:hover.enabled{
    transform: translateY(-2px) scale(1.01);
    box-shadow: 0 16px 26px rgba(0,0,0,0.18), 0 0 30px rgba(79,195,247,0.16);
    border-color: rgba(125,211,252,0.55);
  }
  .product.selected{
    border-color: rgba(125,211,252,0.75);
    box-shadow: 0 18px 30px rgba(0,0,0,0.20), 0 0 40px rgba(79,195,247,0.18);
  }

  .product.affordable:not(.selected):not(.soldout){
    border-color: rgba(34,197,94,0.75);
    box-shadow:
      0 18px 30px rgba(0,0,0,0.18),
      0 0 26px rgba(34,197,94,0.30),
      0 0 46px rgba(34,197,94,0.18);
    filter: saturate(1.06);
  }
  .product.affordable:not(.selected):not(.soldout)::after{
    content:"";
    position:absolute;
    inset:-2px;
    border-radius: 16px;
    background: radial-gradient(circle at 30% 20%, rgba(34,197,94,0.22), transparent 55%);
    opacity:0.85;
    pointer-events:none;
  }

  .product.soldout{ opacity:0.55; filter: grayscale(0.25); cursor:not-allowed !important; }
  .stock-badge{
    position:absolute;
    top: 8px;
    right: 8px;
    font-size: 11px;
    font-weight: 900;
    padding: 5px 8px;
    border-radius: 999px;
    background: rgba(34,197,94,0.18);
    border: 1px solid rgba(34,197,94,0.35);
    color: rgba(234,246,255,0.95);
    z-index:2;
  }
  .stock-badge.low{ background: rgba(245,158,11,0.18); border-color: rgba(245,158,11,0.35); }
  .stock-badge.zero{ background: rgba(239,68,68,0.18); border-color: rgba(239,68,68,0.35); }
  .soldout-overlay{
    position:absolute;
    inset:0;
    display:none;
    place-items:center;
    background: rgba(0,0,0,0.30);
    z-index:5;
    font-weight: 1000;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-size: 14px;
  }
  .product.soldout .soldout-overlay{ display:grid; }

  .product-icon{ font-size: 30px; margin-top: 18px; position:relative; z-index:2; }
  .product-name{ font-size: 12px; font-weight: 900; margin: 6px 0 2px; line-height: 1.15; position:relative; z-index:2; }
  .product-price{ font-size: 12px; opacity: 0.95; font-weight: 900; position:relative; z-index:2; }

  .qty-row{
    margin-top: 8px;
    display:flex;
    justify-content:center;
    gap: 8px;
    align-items:center;
    position:relative;
    z-index:2;
  }
  .qty-btn{
    width: 30px;
    height: 28px;
    border-radius: 10px;
    border: 1px solid rgba(234,246,255,0.28);
    background: rgba(234,246,255,0.85);
    color: #06213a;
    font-weight: 1000;
    cursor:pointer;
    box-shadow: 0 8px 14px rgba(0,0,0,0.10);
    transition: transform .12s ease;
  }
  .qty-btn:active{ transform: scale(0.95); }
  .qty-val{
    min-width: 28px;
    text-align:center;
    font-weight: 1000;
    color: rgba(234,246,255,0.95);
    background: rgba(7,27,47,0.24);
    border: 1px solid rgba(234,246,255,0.16);
    padding: 5px 8px;
    border-radius: 12px;
    font-size: 12px;
  }

  /* Confirm centered */
  .action-buttons{
    position:relative;
    z-index:4;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap: 10px;
    margin-top: 10px;
  }
  .action-buttons .primary{
    width: min(360px, 92%);
    text-align:center;
    font-size: 14px;
  }
  .action-buttons .secondary-row{
    display:flex;
    gap: 10px;
    justify-content:center;
    flex-wrap:wrap;
  }
  .action-buttons button{
    font-size: 13px;
    font-weight: 900;
    padding: 10px 14px;
    border-radius: 12px;
    cursor:pointer;
    border: 1px solid rgba(234,246,255,0.26);
    color: #06213a;
    background: linear-gradient(45deg, rgba(234,246,255,0.92), rgba(125,211,252,0.90));
    box-shadow: 0 12px 24px rgba(0,0,0,0.14), 0 0 36px rgba(79,195,247,0.16);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .action-buttons button:hover{
    transform: translateY(-2px) scale(1.03);
    box-shadow:0 16px 30px rgba(0,0,0,0.18), 0 0 44px rgba(79,195,247,0.20);
  }

  /* Receipt modal */
  .modal-backdrop{
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.40);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
    padding: 18px;
  }
  .modal-backdrop.show{ display:flex; }
  .receipt{
    width: min(520px, 96vw);
    border-radius: 18px;
    background: rgba(234,246,255,0.92);
    border: 1px solid rgba(234,246,255,0.75);
    box-shadow: 0 30px 90px rgba(0,0,0,0.30);
    color:#06213a;
    overflow:hidden;
  }
  .receipt header{
    padding: 14px 16px;
    background: linear-gradient(90deg, rgba(30,136,229,0.18), rgba(79,195,247,0.18));
    border-bottom: 1px solid rgba(11,79,168,0.12);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
  }
  .receipt header .title{ font-weight:1000; }
  .receipt header button{
    border:none;
    background: rgba(7,27,47,0.08);
    padding: 8px 10px;
    border-radius: 12px;
    font-weight: 900;
    cursor:pointer;
  }
  .receipt .body{ padding: 14px 16px 16px; }
  .receipt .rows{
    margin-top: 10px;
    border: 1px dashed rgba(11,79,168,0.20);
    border-radius: 14px;
    padding: 10px 12px;
    background: rgba(255,255,255,0.55);
  }
  .receipt .row{
    display:flex;
    justify-content:space-between;
    gap: 10px;
    padding: 6px 0;
    font-weight: 800;
  }
  .receipt .row small{ opacity:0.75; font-weight: 900; }
  .receipt .divider{ height:1px; background: rgba(11,79,168,0.12); margin: 10px 0; }
  .receipt .totals .row{ font-weight: 1000; }
  .receipt .totals .row strong{ color: var(--mid); }

  /* Confetti */
  .confetti{
    position:fixed;
    top:-20px;
    width: 10px;
    height: 16px;
    border-radius: 3px;
    z-index: 9999;
    opacity: 0.95;
    animation: confettiFall 1.6s ease-in forwards;
    pointer-events:none;
  }
  @keyframes confettiFall{
    0%{ transform: translateY(-20px) rotate(0deg); opacity:1; }
    100%{ transform: translateY(110vh) rotate(420deg); opacity:0; }
  }

  @media (prefers-reduced-motion: reduce){
    .orbit, .cloud { animation:none !important; }
    .center-message.show{ animation:none !important; opacity:0 !important; }
  }
</style>
</head>

<body>

  <div class="sky-layer" aria-hidden="true">
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div class="cloud c3"></div>
    <div class="cloud c4"></div>
  </div>

  <!-- LOOP planes -->
  <div class="loop-wrap" aria-hidden="true">
    <div class="loop">
      <div class="orbit"><div class="plane">‚úàÔ∏è</div></div>
      <div class="orbit slow reverse"><div class="plane">üõ©Ô∏è</div></div>
      <div class="orbit slower"><div class="plane">‚úàÔ∏è</div></div>
    </div>

    <div class="mini-loop ml1"><div class="orbit"><div class="plane">üõ©Ô∏è</div></div></div>
    <div class="mini-loop ml2"><div class="orbit reverse"><div class="plane">‚úàÔ∏è</div></div></div>
    <div class="mini-loop ml3"><div class="orbit slow"><div class="plane">‚úàÔ∏è</div></div></div>
    <div class="mini-loop ml4"><div class="orbit slow reverse"><div class="plane">üõ©Ô∏è</div></div></div>
  </div>

  <div class="vending-container" id="machine">
    <div class="shine"></div>

    <div class="inner-stickers" aria-hidden="true">
      <span class="st1">üó∫Ô∏è</span>
      <span class="st2">üß≥</span>
      <span class="st3">üß≠</span>
      <span class="st4">üì∏</span>
      <span class="st5">üå¥</span>
      <span class="st6">üèùÔ∏è</span>
      <span class="st7">üõ´</span>
      <span class="st8">üìç</span>
    </div>

    <div class="header">
      <h1>Travel Vending Machine</h1>
      <p>Adventure Essentials ‚Ä¢ Explore &amp; Go!</p>
    </div>

    <div class="screen" id="screenBox">
      <!-- ‚úÖ emojis inside the display panel -->
      <div class="screen-emojis" aria-hidden="true">
        <span style="--x:8%;  --y:22%; --r:-14deg; --d:0s;">üß≥</span>
        <span style="--x:14%; --y:62%; --r:10deg;  --d:-1.2s;">üó∫Ô∏è</span>
        <span style="--x:28%; --y:14%; --r:8deg;   --d:-0.6s;">üìç</span>
        <span style="--x:72%; --y:18%; --r:-8deg;  --d:-1.6s;">üõ´</span>
        <span style="--x:86%; --y:40%; --r:12deg;  --d:-0.9s;">üì∏</span>
        <span style="--x:80%; --y:72%; --r:-10deg; --d:-1.3s;">üß≠</span>
      </div>

      <p><strong>Balance:</strong> <span id="balance">0</span> NTD</p>
      <p id="inserted-coins">Inserted coins: 0</p>
      <p id="total">Total Selected: 0 NTD</p>
      <p id="remaining">Remaining Balance: 0 NTD</p>
      <p id="message">ü™ô Please insert coins to begin!</p>

      <div id="dispense-msg" class="center-message">üéÅ Dispensing...</div>
      <div id="success-msg" class="center-message">‚úÖ Purchase complete! ‚úàÔ∏è</div>
      <div id="error-msg" class="center-message">‚ö†Ô∏è Oops!</div>
    </div>

    <div class="coin-section">
      <h3>Insert Coins</h3>
      <div class="coin-buttons">
        <button onclick="insert(50)">NT$50</button>
        <button onclick="insert(100)">NT$100</button>
        <button onclick="insert(500)">NT$500</button>
        <button onclick="insert(1000)">NT$1000</button>
      </div>
    </div>

    <div class="product-section" id="productGrid">
      <div class="product" data-price="350" data-stock="5" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">5</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üéß</div>
        <div class="product-name">Noise-Cancelling Headphones</div>
        <div class="product-price">350 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="250" data-stock="6" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">6</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üîã</div>
        <div class="product-name">Portable Power Bank</div>
        <div class="product-price">250 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="150" data-stock="8" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">8</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üò¥</div>
        <div class="product-name">Luxury Eye Mask</div>
        <div class="product-price">150 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="200" data-stock="5" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">5</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üí§</div>
        <div class="product-name">Memory Foam Pillow</div>
        <div class="product-price">200 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="180" data-stock="7" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">7</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üîå</div>
        <div class="product-name">Premium Adapter</div>
        <div class="product-price">180 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="220" data-stock="4" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">4</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üëù</div>
        <div class="product-name">Neck Wallet</div>
        <div class="product-price">220 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="300" data-stock="3" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">3</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">ü©π</div>
        <div class="product-name">First Aid Kit Deluxe</div>
        <div class="product-price">300 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="270" data-stock="6" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">6</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üß¥</div>
        <div class="product-name">Toiletry Bottles</div>
        <div class="product-price">270 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="primary" onclick="confirmPurchase()">üßæ Confirm Purchase</button>
      <div class="secondary-row">
        <button onclick="returnChange()">üí∞ Return Change</button>
        <button onclick="resetMachine()">üîÑ Reset</button>
      </div>
    </div>
  </div>

  <!-- Receipt panel -->
  <div class="modal-backdrop" id="receiptBackdrop" onclick="hideReceipt()">
    <div class="receipt" onclick="event.stopPropagation()">
      <header>
        <div class="title">üßæ Receipt</div>
        <button onclick="hideReceipt()">Close</button>
      </header>
      <div class="body">
        <div id="receiptItems" class="rows"></div>
        <div class="divider"></div>
        <div class="totals">
          <div class="row"><span>Total</span><strong id="receiptTotal">0</strong></div>
          <div class="row"><span>Balance After</span><strong id="receiptAfter">0</strong></div>
          <div class="row"><span>Change</span><strong id="receiptChange">0</strong></div>
        </div>
      </div>
    </div>
  </div>

<script>
  let balance = 0;
  let insertedCoins = [];

  const quotes = [
    "‚úàÔ∏è Your journey begins now!",
    "üåç Explore the world, one step at a time.",
    "üß≥ Travel light, live fully.",
    "üèñÔ∏è Collect moments, not things.",
    "üöÄ Ready for takeoff!"
  ];

  function currentTotal(){
    let total = 0;
    document.querySelectorAll(".product").forEach(card=>{
      const qty = parseInt(card.querySelector(".qty-val").textContent) || 0;
      const price = parseInt(card.dataset.price);
      total += qty * price;
    });
    return total;
  }

  function remaining(){
    return balance - currentTotal();
  }

  function updateDisplay(){
    document.getElementById("balance").textContent = balance;
    document.getElementById("inserted-coins").textContent =
      insertedCoins.length ? "Inserted coins: " + insertedCoins.join(",") : "Inserted coins: 0";

    const total = currentTotal();
    const rem = remaining();

    document.getElementById("total").textContent = `Total Selected: ${total} NTD`;
    document.getElementById("remaining").textContent = `Remaining Balance: ${Math.max(0, rem)} NTD`;

    document.querySelectorAll(".product").forEach(card=>{
      const stock = parseInt(card.dataset.stock);
      const price = parseInt(card.dataset.price);
      const qty = parseInt(card.querySelector(".qty-val").textContent) || 0;

      if(stock <= 0){
        card.classList.add("soldout");
        card.classList.remove("enabled","affordable");
        card.querySelector(".qty-val").textContent = "0";
        card.classList.remove("selected");
      } else {
        card.classList.toggle("enabled", balance > 0);
      }

      const badge = card.querySelector(".stock-badge");
      badge.classList.remove("low","zero");
      if(stock === 0) badge.classList.add("zero");
      else if(stock <= 2) badge.classList.add("low");
      card.querySelector(".stock").textContent = stock;

      if(!card.classList.contains("soldout") && qty === 0 && balance > 0 && price <= rem){
        card.classList.add("affordable");
      } else {
        card.classList.remove("affordable");
      }
    });
  }

  function setMessage(msg){ document.getElementById("message").textContent = msg; }

  function showCenter(id, text, duration=1300){
    const el = document.getElementById(id);
    if(text) el.textContent = text;
    el.classList.remove("show");
    void el.offsetWidth;
    el.classList.add("show");
    setTimeout(()=> el.classList.remove("show"), duration);
  }

  function insert(amount){
    balance += amount;
    insertedCoins.push(`NT$${amount}`);
    setMessage(`ü™ô Inserted NT$${amount}. Balance: NT$${balance}`);
    updateDisplay();
  }

  function toggleSelect(card){
    if(card.classList.contains("soldout") || !card.classList.contains("enabled")) return;

    const qtyEl = card.querySelector(".qty-val");
    let qty = parseInt(qtyEl.textContent) || 0;
    const price = parseInt(card.dataset.price);

    if(qty === 0){
      if(remaining() - price < 0){
        showCenter("error-msg", "‚ö†Ô∏è Not enough balance!", 1200);
        setMessage("‚ö†Ô∏è Not enough balance for this item!");
        return;
      }
      qtyEl.textContent = "1";
      card.classList.add("selected");
    } else {
      qtyEl.textContent = "0";
      card.classList.remove("selected");
    }

    updateDisplay();
    setMessage("üõí Updated selection.");
  }

  function qtyUp(ev, btn){
    ev.stopPropagation();
    const card = btn.closest(".product");
    if(card.classList.contains("soldout") || !card.classList.contains("enabled")) return;

    const stock = parseInt(card.dataset.stock);
    const qtyEl = card.querySelector(".qty-val");
    let qty = parseInt(qtyEl.textContent) || 0;

    if(qty >= stock){
      showCenter("error-msg", "‚ö†Ô∏è No more stock!", 1200);
      setMessage("‚ö†Ô∏è Reached stock limit.");
      return;
    }

    const price = parseInt(card.dataset.price);
    if(remaining() - price < 0){
      showCenter("error-msg", "‚ö†Ô∏è Not enough balance!", 1200);
      setMessage("‚ö†Ô∏è Add more coins to increase quantity.");
      return;
    }

    qtyEl.textContent = String(qty + 1);
    card.classList.add("selected");
    updateDisplay();
  }

  function qtyDown(ev, btn){
    ev.stopPropagation();
    const card = btn.closest(".product");
    if(card.classList.contains("soldout") || !card.classList.contains("enabled")) return;

    const qtyEl = card.querySelector(".qty-val");
    let qty = parseInt(qtyEl.textContent) || 0;
    qty = Math.max(0, qty - 1);
    qtyEl.textContent = String(qty);

    if(qty === 0) card.classList.remove("selected");
    updateDisplay();
  }

  function confettiBurst(n=28){
    const w = window.innerWidth;
    for(let i=0;i<n;i++){
      const c = document.createElement("div");
      c.className = "confetti";
      c.style.left = Math.floor(Math.random()*w) + "px";
      c.style.animationDelay = (Math.random()*0.2) + "s";
      const hue = Math.floor(Math.random()*360);
      c.style.background = `hsl(${hue} 90% 60%)`;
      document.body.appendChild(c);
      setTimeout(()=>c.remove(), 1900);
    }
  }

  function showReceipt(items, total, after){
    const box = document.getElementById("receiptItems");
    box.innerHTML = items.map(it => `
      <div class="row">
        <span>${it.name} <small>√ó ${it.qty}</small></span>
        <span>${it.line} NTD</span>
      </div>
    `).join("");

    document.getElementById("receiptTotal").textContent = `${total} NTD`;
    document.getElementById("receiptAfter").textContent = `${after} NTD`;
    document.getElementById("receiptChange").textContent = `${after} NTD`;
    document.getElementById("receiptBackdrop").classList.add("show");
  }

  function hideReceipt(){
    document.getElementById("receiptBackdrop").classList.remove("show");
  }

  function confirmPurchase(){
    const items = [];
    document.querySelectorAll(".product").forEach(card=>{
      const qty = parseInt(card.querySelector(".qty-val").textContent) || 0;
      if(qty > 0){
        const price = parseInt(card.dataset.price);
        items.push({
          name: card.querySelector(".product-name").textContent,
          qty,
          line: qty * price,
          card
        });
      }
    });

    if(items.length === 0){
      showCenter("error-msg", "‚ö†Ô∏è Select an item!", 1200);
      setMessage("‚ö†Ô∏è Select at least one product!");
      return;
    }

    const total = currentTotal();
    if(total > balance){
      showCenter("error-msg", "‚ö†Ô∏è Not enough balance!", 1200);
      setMessage(`‚ö†Ô∏è Need NT$${total-balance} more.`);
      return;
    }

    balance -= total;

    items.forEach(it=>{
      const card = it.card;
      const newStock = Math.max(0, parseInt(card.dataset.stock) - it.qty);
      card.dataset.stock = newStock;
      card.querySelector(".qty-val").textContent = "0";
      card.classList.remove("selected");
    });

    showCenter("dispense-msg", "üéÅ Dispensing...", 1200);

    setTimeout(()=>{
      const quote = quotes[Math.floor(Math.random()*quotes.length)];
      setMessage(`üéâ Purchased ${items.length} item(s) for NT$${total}!\n${quote}`);
      showCenter("success-msg", "‚úÖ Done! Have a great trip ‚úàÔ∏è", 1400);
      confettiBurst(30);
      showReceipt(items, total, balance);
      updateDisplay();
    }, 750);
  }

  function returnChange(){
    if(balance <= 0){
      showCenter("error-msg", "‚ÑπÔ∏è No change to return", 1100);
      setMessage("‚ÑπÔ∏è Balance is already 0.");
      return;
    }
    const returned = balance;
    balance = 0;
    insertedCoins = [];
    setMessage(`üí∞ Returned NT$${returned} change. Insert coins to begin!`);
    showCenter("success-msg", `üí∞ Returned NT$${returned}`, 1400);

    document.querySelectorAll(".product").forEach(card=>{
      card.querySelector(".qty-val").textContent = "0";
      card.classList.remove("selected");
    });

    updateDisplay();
  }

  function resetMachine(){
    balance = 0;
    insertedCoins = [];
    setMessage("ü™ô Please insert coins to begin!");
    document.querySelectorAll(".product").forEach(card=>{
      card.querySelector(".qty-val").textContent = "0";
      card.classList.remove("selected");
    });
    updateDisplay();
  }

  updateDisplay();
</script>

</body>
</html>
