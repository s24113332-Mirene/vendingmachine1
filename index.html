<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Travel Vending Machine</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

<style>
  :root{
    --navy:#061a2f;
    --mid:#0b4fa8;
    --blue:#1e88e5;
    --sky:#4fc3f7;
    --ice:#eaf6ff;
    --shadow: rgba(0,0,0,0.28);
    --glow: rgba(79,195,247,0.45);
    --good: rgba(34,197,94,0.55);
  }

  /* One-screen layout */
  html, body { height: 100%; }
  body{
    margin:0;
    height: 100vh;
    overflow: hidden; /* no page scroll */
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:'Poppins',sans-serif;
    position:relative;

    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(79,195,247,0.25), transparent 60%),
      radial-gradient(1100px 700px at 85% 35%, rgba(30,136,229,0.20), transparent 62%),
      linear-gradient(180deg, #061a2f 0%, #0a2b4b 48%, #061a2f 100%);
  }

  body::before{
    content:"";
    position:fixed;
    inset:0;
    background-image:url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/World_map_-_low_resolution.svg/1200px-World_map_-_low_resolution.svg.png');
    background-size:cover;
    background-position:center;
    background-repeat:no-repeat;
    opacity:0.10;
    filter: hue-rotate(190deg) saturate(1.35) contrast(1.05);
    transform: scale(1.02);
    pointer-events:none;
    z-index:0;
  }
  body::after{
    content:"";
    position:fixed;
    inset:0;
    background:
      radial-gradient(900px 520px at 50% 35%, rgba(234,246,255,0.10), transparent 70%),
      radial-gradient(1400px 900px at 50% 50%, transparent 55%, rgba(0,0,0,0.35) 100%),
      linear-gradient(180deg, rgba(234,246,255,0.05), rgba(0,0,0,0.20));
    backdrop-filter: blur(1.2px);
    pointer-events:none;
    z-index:1;
  }

  /* ‚úàÔ∏è More planes (bigger + more visible) */
  .sky-layer{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:2;
    overflow:hidden;
  }

  .plane{
    position:absolute;
    font-size: clamp(38px, 4.2vw, 76px);  /* bigger */
    opacity:0.82;                         /* more visible */
    filter: drop-shadow(0 18px 28px rgba(0,0,0,0.32));
    will-change: transform;
    user-select:none;
  }

  /* Sine left->right */
  .p-sine{ left:-25%; top:10%; animation: planeSine 14s linear infinite; }
  .p-sine2{ left:-30%; top:22%; opacity:0.70; font-size: clamp(34px, 3.8vw, 68px); animation: planeSine 18s linear infinite; animation-delay:-8s; }
  .p-sine3{ left:-28%; top:40%; opacity:0.72; font-size: clamp(32px, 3.6vw, 64px); animation: planeSine 16s linear infinite; animation-delay:-4s; }
  .p-sine4{ left:-35%; top:62%; opacity:0.62; font-size: clamp(30px, 3.4vw, 60px); animation: planeSine 22s linear infinite; animation-delay:-14s; }
  .p-sine5{ left:-26%; top:78%; opacity:0.58; font-size: clamp(28px, 3.2vw, 56px); animation: planeSine 20s linear infinite; animation-delay:-10s; }

  @keyframes planeSine{
    0%   { transform: translateX(-260px) translateY(0) rotate(-12deg); }
    25%  { transform: translateX(28vw) translateY(-22px) rotate(-6deg); }
    50%  { transform: translateX(55vw) translateY(18px) rotate(0deg); }
    75%  { transform: translateX(82vw) translateY(-18px) rotate(6deg); }
    100% { transform: translateX(calc(100vw + 300px)) translateY(0) rotate(12deg); }
  }

  /* Right->left */
  .p-rl1{ right:-25%; top:16%; animation: planeRL 20s linear infinite; transform: rotate(180deg); opacity:0.68; }
  .p-rl2{ right:-30%; top:54%; animation: planeRL 26s linear infinite; transform: rotate(180deg); opacity:0.56; font-size: clamp(30px, 3.4vw, 60px); animation-delay:-9s; }
  .p-rl3{ right:-35%; top:86%; animation: planeRL 30s linear infinite; transform: rotate(180deg); opacity:0.48; font-size: clamp(26px, 3vw, 52px); animation-delay:-16s; }

  @keyframes planeRL{
    0%   { transform: translateX(0) translateY(0) rotate(190deg); }
    25%  { transform: translateX(-25vw) translateY(18px) rotate(184deg); }
    50%  { transform: translateX(-52vw) translateY(-14px) rotate(180deg); }
    75%  { transform: translateX(-78vw) translateY(16px) rotate(176deg); }
    100% { transform: translateX(calc(-100vw - 420px)) translateY(0) rotate(170deg); }
  }

  /* Figure-eight (‚àû) around center */
  .p-eight{
    left:50%;
    top:50%;
    transform: translate(-50%,-50%);
    animation: figureEight 18s linear infinite;
    opacity:0.55;
  }
  .p-eight2{
    left:50%;
    top:50%;
    transform: translate(-50%,-50%);
    animation: figureEight 26s linear infinite reverse;
    opacity:0.38;
    font-size: clamp(30px, 3.4vw, 60px);
  }
  @keyframes figureEight{
    0%   { transform: translate(-50%,-50%) translate(0,0) rotate(0deg); }
    25%  { transform: translate(-50%,-50%) translate(280px,-110px) rotate(14deg); }
    50%  { transform: translate(-50%,-50%) translate(0,-12px) rotate(0deg); }
    75%  { transform: translate(-50%,-50%) translate(-280px,110px) rotate(-14deg); }
    100% { transform: translate(-50%,-50%) translate(0,0) rotate(0deg); }
  }

  /* Orbit */
  .orbit-wrap{
    position:fixed;
    left:50%;
    top:50%;
    width: 120vmax;
    height: 120vmax;
    transform: translate(-50%, -50%);
    z-index:2;
    opacity:0.30;
    pointer-events:none;
  }
  .orbit{ position:absolute; inset:0; animation: orbit 28s linear infinite; }
  .orbit2{ animation-duration: 40s; animation-direction: reverse; opacity:0.22; }
  .orbit3{ animation-duration: 56s; opacity:0.18; }
  .orb-plane{
    position:absolute;
    left: 50%;
    top: 2%;
    transform: translateX(-50%);
    font-size: clamp(32px, 3.8vw, 70px);
    filter: drop-shadow(0 18px 28px rgba(0,0,0,0.28));
  }
  @keyframes orbit{ from{ transform: rotate(0deg); } to{ transform: rotate(360deg); } }

  /* üíº Vending container (3-gradient) */
  .vending-container{
    width: min(980px, 94vw);
    max-height: 92vh;                 /* keep inside one screen */
    padding: clamp(14px, 2vh, 24px);
    border-radius: 30px;
    color: #fff;
    position:relative;
    z-index:5;
    overflow:hidden;

    background:
      radial-gradient(900px 500px at 12% 0%, rgba(79,195,247,0.30), transparent 55%),
      linear-gradient(145deg, #071f3a 0%, #0b4fa8 50%, #4fc3f7 100%);
    border: 6px solid rgba(125, 211, 252, 0.55);
    box-shadow: 0 26px 80px rgba(0,0,0,0.28), 0 0 60px rgba(79,195,247,0.20);
  }

  .vending-container::before{
    content:'';
    position:absolute;
    top:-46px;
    left:50%;
    transform:translateX(-50%);
    width: 170px;
    height: 40px;
    background: linear-gradient(90deg, rgba(79,195,247,0.95), rgba(30,136,229,0.95));
    border-radius: 22px 22px 0 0;
    box-shadow: 0 12px 20px rgba(0,0,0,0.22);
    border: 3px solid rgba(234,246,255,0.25);
    z-index:2;
  }

  .shine{
    position:absolute;
    inset:-40% -20% auto -30%;
    height: 70%;
    background: linear-gradient(120deg, rgba(255,255,255,0.16), rgba(255,255,255,0) 55%);
    transform: rotate(12deg);
    pointer-events:none;
    z-index:0;
  }

  /* Centered header */
  .header{
    position:relative;
    z-index:3;
    text-align:center;
    padding: 12px 14px;
    border-radius: 16px;
    background: linear-gradient(90deg, rgba(234,246,255,0.14), rgba(79,195,247,0.14), rgba(234,246,255,0.08));
    border: 1px solid rgba(234,246,255,0.20);
    box-shadow: 0 0 18px rgba(79,195,247,0.16);
    margin-bottom: 10px;
  }
  .header h1{
    margin:0;
    font-family:'Playfair Display', serif;
    font-size: clamp(18px, 2.4vw, 28px);
    letter-spacing: 0.4px;
  }
  .header p{
    margin:6px 0 0;
    font-weight:700;
    opacity:0.95;
    font-size: clamp(12px, 1.4vw, 14px);
  }

  /* ‚úÖ Text box: add a visible gradient like your screenshot */
  .screen{
    position:relative;
    z-index:3;
    width: min(820px, 100%);
    margin: 0 auto 10px;
    padding: 12px 14px;
    border-radius: 18px;
    color: #08233f;
    text-align:center;

    /* Gradient panel */
    background:
      radial-gradient(900px 260px at 20% 0%, rgba(255,255,255,0.55), rgba(255,255,255,0) 60%),
      linear-gradient(135deg, rgba(245,252,255,0.96) 0%, rgba(214,238,255,0.92) 45%, rgba(194,227,255,0.90) 100%);
    border: 1px solid rgba(234,246,255,0.78);
    box-shadow:
      0 14px 34px rgba(0,0,0,0.18),
      0 0 26px rgba(79,195,247,0.18),
      inset 0 0 0 1px rgba(255,255,255,0.35);
    backdrop-filter: blur(10px);
    overflow:hidden;
  }
  .screen::before{
    content:"";
    position:absolute;
    inset:0;
    background: linear-gradient(115deg, rgba(255,255,255,0.20), rgba(255,255,255,0) 60%);
    opacity:0.75;
    pointer-events:none;
  }
  .screen p{
    margin: 6px 0;
    font-weight:800;
    position:relative;
    z-index:2;
    font-size: clamp(12px, 1.35vw, 14px);
  }
  #balance{ color: var(--mid); font-size: clamp(16px, 1.8vw, 20px); font-weight:900; }
  #inserted-coins{ color: var(--blue); font-style: italic; font-weight:800; }
  #message{ white-space: pre-line; }

  /* Center overlays */
  .center-message{
    pointer-events:none;
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%) scale(0.86);
    opacity:0;
    text-align:center;
    font-weight:900;
    letter-spacing: 0.8px;
    font-size: clamp(16px, 2vw, 22px);
    z-index:5;
    padding: 12px 22px;
    border-radius: 18px;
    text-shadow: 0 12px 22px rgba(0,0,0,0.22);
    box-shadow: 0 0 28px rgba(255,255,255,0.55);
    filter: drop-shadow(0 18px 30px rgba(0,0,0,0.18));
  }
  .center-message.show{ animation: popGlow 1.35s ease forwards; }
  .center-message::after{
    content:"";
    position:absolute;
    inset:-10px;
    border-radius: 22px;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,255,255,0.55), transparent 40%),
      radial-gradient(circle at 70% 20%, rgba(255,255,255,0.45), transparent 42%),
      radial-gradient(circle at 80% 70%, rgba(255,255,255,0.40), transparent 45%),
      radial-gradient(circle at 30% 80%, rgba(255,255,255,0.35), transparent 45%);
    opacity:0;
    animation: twinkle 1.35s ease forwards;
    pointer-events:none;
  }
  @keyframes popGlow{
    0%   { opacity:0; transform: translate(-50%, -50%) scale(0.82); }
    16%  { opacity:1; transform: translate(-50%, -50%) scale(1.06); }
    36%  { transform: translate(-50%, -50%) scale(0.98); }
    62%  { transform: translate(-50%, -50%) scale(1.02); }
    100% { opacity:0; transform: translate(-50%, -50%) scale(1.00); }
  }
  @keyframes twinkle{ 0%{opacity:0;} 20%{opacity:0.75;} 100%{opacity:0;} }

  #dispense-msg{ background: linear-gradient(45deg, rgba(30,136,229,0.95), rgba(79,195,247,0.95)); color:#fff; border:1px solid rgba(234,246,255,0.35); }
  #success-msg{ background: linear-gradient(45deg, rgba(34,197,94,0.92), rgba(125,211,252,0.92)); color:#06213a; border:1px solid rgba(234,246,255,0.35); }
  #error-msg{ background: linear-gradient(45deg, rgba(239,68,68,0.92), rgba(245,158,11,0.92)); color:#061a2f; border:1px solid rgba(234,246,255,0.35); }

  /* Coin buttons (compact) */
  .coin-section{ position:relative; z-index:3; text-align:center; }
  .coin-section h3{ margin: 8px 0 8px; font-weight:900; font-size: clamp(12px, 1.4vw, 14px); }
  .coin-buttons{
    display:flex;
    justify-content:center;
    gap: 10px;
    flex-wrap:wrap;
  }
  .coin-buttons button{
    font-weight:900;
    font-size: clamp(12px, 1.35vw, 14px);
    padding: 10px 14px;
    border-radius: 12px;
    border: 1px solid rgba(234,246,255,0.32);
    cursor:pointer;
    color:#06213a;
    background: linear-gradient(45deg, rgba(234,246,255,0.92), rgba(125,211,252,0.90));
    box-shadow: 0 10px 22px rgba(0,0,0,0.16), 0 0 30px rgba(79,195,247,0.22);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .coin-buttons button:hover{
    transform: translateY(-2px) scale(1.04);
    box-shadow:0 16px 30px rgba(0,0,0,0.20), 0 0 42px rgba(79,195,247,0.26);
  }

  /* Products grid: 4 columns desktop so it fits in one screen */
  .product-section{
    position:relative;
    z-index:3;
    display:grid;
    grid-template-columns: repeat(4, minmax(0,1fr));
    gap: 10px;
    margin-top: 10px;
  }
  @media (max-width: 900px){
    .product-section{ grid-template-columns: repeat(3, minmax(0,1fr)); }
  }
  @media (max-width: 680px){
    .product-section{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  }

  .product{
    position:relative;
    border-radius: 14px;
    padding: 10px 10px 10px;
    text-align:center;
    user-select:none;
    overflow:hidden;
    cursor:not-allowed;
    border: 1px solid rgba(234,246,255,0.20);
    background:
      radial-gradient(280px 160px at 20% 0%, rgba(255,255,255,0.16), transparent 55%),
      linear-gradient(180deg, rgba(234,246,255,0.12), rgba(125,211,252,0.08));
    box-shadow: inset 0 0 0 2px rgba(11,42,74,0.10), 0 10px 18px rgba(0,0,0,0.16);
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, opacity .18s ease, filter .18s ease;
    min-height: 130px;
  }

  .product.enabled{ cursor:pointer; }
  .product:hover.enabled{
    transform: translateY(-2px) scale(1.01);
    box-shadow: 0 16px 26px rgba(0,0,0,0.20), 0 0 30px rgba(79,195,247,0.18);
    border-color: rgba(125,211,252,0.55);
  }
  .product.selected{
    border-color: rgba(125,211,252,0.75);
    box-shadow: 0 18px 30px rgba(0,0,0,0.22), 0 0 40px rgba(79,195,247,0.22);
  }

  /* ‚úÖ Glow products the user can afford (based on remaining balance) */
  .product.affordable:not(.selected):not(.soldout){
    border-color: rgba(34,197,94,0.75);
    box-shadow:
      0 18px 30px rgba(0,0,0,0.20),
      0 0 26px rgba(34,197,94,0.30),
      0 0 46px rgba(34,197,94,0.18);
    filter: saturate(1.05);
  }
  .product.affordable:not(.selected):not(.soldout)::after{
    content:"";
    position:absolute;
    inset:-2px;
    border-radius: 16px;
    background: radial-gradient(circle at 30% 20%, rgba(34,197,94,0.22), transparent 55%);
    opacity:0.8;
    pointer-events:none;
  }

  .product.soldout{
    opacity:0.55;
    filter: grayscale(0.25);
    cursor:not-allowed !important;
  }

  .stock-badge{
    position:absolute;
    top: 8px;
    right: 8px;
    font-size: 11px;
    font-weight: 900;
    padding: 5px 8px;
    border-radius: 999px;
    background: rgba(34,197,94,0.18);
    border: 1px solid rgba(34,197,94,0.35);
    color: rgba(234,246,255,0.95);
    z-index:2;
  }
  .stock-badge.low{ background: rgba(245,158,11,0.18); border-color: rgba(245,158,11,0.35); }
  .stock-badge.zero{ background: rgba(239,68,68,0.18); border-color: rgba(239,68,68,0.35); }

  .soldout-overlay{
    position:absolute;
    inset:0;
    display:none;
    place-items:center;
    background: rgba(0,0,0,0.30);
    z-index:5;
    font-weight: 1000;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-size: 14px;
  }
  .product.soldout .soldout-overlay{ display:grid; }

  .product-icon{ font-size: 30px; margin-top: 18px; position:relative; z-index:2; }
  .product-name{ font-size: 12px; font-weight: 900; margin: 6px 0 2px; line-height: 1.15; position:relative; z-index:2; }
  .product-price{ font-size: 12px; opacity: 0.95; font-weight: 900; position:relative; z-index:2; }

  .qty-row{
    margin-top: 8px;
    display:flex;
    justify-content:center;
    gap: 8px;
    align-items:center;
    position:relative;
    z-index:2;
  }
  .qty-btn{
    width: 30px;
    height: 28px;
    border-radius: 10px;
    border: 1px solid rgba(234,246,255,0.28);
    background: rgba(234,246,255,0.85);
    color: #06213a;
    font-weight: 1000;
    cursor:pointer;
    box-shadow: 0 8px 14px rgba(0,0,0,0.12);
    transition: transform .12s ease;
  }
  .qty-btn:active{ transform: scale(0.95); }
  .qty-val{
    min-width: 28px;
    text-align:center;
    font-weight: 1000;
    color: rgba(234,246,255,0.95);
    background: rgba(7,27,47,0.24);
    border: 1px solid rgba(234,246,255,0.16);
    padding: 5px 8px;
    border-radius: 12px;
    font-size: 12px;
  }

  /* Action buttons (compact) */
  .action-buttons{
    position:relative;
    z-index:3;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap: 10px;
    margin-top: 10px;
  }
  .action-buttons button{
    font-size: 13px;
    font-weight: 900;
    padding: 10px 14px;
    border-radius: 12px;
    cursor:pointer;
    border: 1px solid rgba(234,246,255,0.26);
    color: #06213a;
    background: linear-gradient(45deg, rgba(234,246,255,0.92), rgba(125,211,252,0.90));
    box-shadow: 0 12px 24px rgba(0,0,0,0.16), 0 0 36px rgba(79,195,247,0.18);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .action-buttons button:hover{
    transform: translateY(-2px) scale(1.03);
    box-shadow:0 16px 30px rgba(0,0,0,0.20), 0 0 44px rgba(79,195,247,0.22);
  }

  /* Receipt modal */
  .modal-backdrop{
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.45);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
    padding: 18px;
  }
  .modal-backdrop.show{ display:flex; }

  .receipt{
    width: min(520px, 96vw);
    border-radius: 18px;
    background: rgba(234,246,255,0.92);
    border: 1px solid rgba(234,246,255,0.75);
    box-shadow: 0 30px 90px rgba(0,0,0,0.35);
    color:#06213a;
    overflow:hidden;
  }
  .receipt header{
    padding: 14px 16px;
    background: linear-gradient(90deg, rgba(30,136,229,0.18), rgba(79,195,247,0.18));
    border-bottom: 1px solid rgba(11,79,168,0.12);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
  }
  .receipt header .title{ font-weight:1000; }
  .receipt header button{
    border:none;
    background: rgba(7,27,47,0.08);
    padding: 8px 10px;
    border-radius: 12px;
    font-weight: 900;
    cursor:pointer;
  }
  .receipt .body{ padding: 14px 16px 16px; }
  .receipt .rows{
    margin-top: 10px;
    border: 1px dashed rgba(11,79,168,0.20);
    border-radius: 14px;
    padding: 10px 12px;
    background: rgba(255,255,255,0.55);
  }
  .receipt .row{
    display:flex;
    justify-content:space-between;
    gap: 10px;
    padding: 6px 0;
    font-weight: 800;
  }
  .receipt .row small{ opacity:0.75; font-weight: 900; }
  .receipt .divider{ height:1px; background: rgba(11,79,168,0.12); margin: 10px 0; }
  .receipt .totals .row{ font-weight: 1000; }
  .receipt .totals .row strong{ color: var(--mid); }

  /* Confetti */
  .confetti{
    position:fixed;
    top:-20px;
    width: 10px;
    height: 16px;
    border-radius: 3px;
    z-index: 9999;
    opacity: 0.95;
    animation: confettiFall 1.6s ease-in forwards;
    pointer-events:none;
  }
  @keyframes confettiFall{
    0%{ transform: translateY(-20px) rotate(0deg); opacity:1; }
    100%{ transform: translateY(110vh) rotate(420deg); opacity:0; }
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .plane, .orbit { animation:none !important; }
    .center-message.show{ animation:none !important; opacity:0 !important; }
  }
</style>
</head>

<body>

  <div class="sky-layer" aria-hidden="true">
    <!-- more planes -->
    <div class="plane p-sine">‚úàÔ∏è</div>
    <div class="plane p-sine2">üõ©Ô∏è</div>
    <div class="plane p-sine3">‚úàÔ∏è</div>
    <div class="plane p-sine4">üõ©Ô∏è</div>
    <div class="plane p-sine5">‚úàÔ∏è</div>

    <div class="plane p-rl1">‚úàÔ∏è</div>
    <div class="plane p-rl2">üõ©Ô∏è</div>
    <div class="plane p-rl3">‚úàÔ∏è</div>

    <div class="plane p-eight">‚úàÔ∏è</div>
    <div class="plane p-eight2">üõ©Ô∏è</div>

    <div class="orbit-wrap">
      <div class="orbit"><div class="orb-plane">üõ©Ô∏è</div></div>
      <div class="orbit orbit2"><div class="orb-plane">‚úàÔ∏è</div></div>
      <div class="orbit orbit3"><div class="orb-plane">‚úàÔ∏è</div></div>
    </div>
  </div>

  <div class="vending-container" id="machine">
    <div class="shine"></div>

    <div class="header">
      <h1>Travel Vending Machine</h1>
      <p>Adventure Essentials ‚Ä¢ Explore &amp; Go!</p>
    </div>

    <div class="screen" id="screenBox">
      <p><strong>Balance:</strong> <span id="balance">0</span> NTD</p>
      <p id="inserted-coins">Inserted coins: 0</p>
      <p id="total">Total Selected: 0 NTD</p>
      <p id="remaining">Remaining Balance: 0 NTD</p>
      <p id="message">ü™ô Please insert coins to begin!</p>

      <div id="dispense-msg" class="center-message">üéÅ Dispensing...</div>
      <div id="success-msg" class="center-message">‚úÖ Purchase complete! ‚úàÔ∏è</div>
      <div id="error-msg" class="center-message">‚ö†Ô∏è Oops!</div>
    </div>

    <div class="coin-section">
      <h3>Insert Coins</h3>
      <div class="coin-buttons">
        <button onclick="insert(50)">NT$50</button>
        <button onclick="insert(100)">NT$100</button>
        <button onclick="insert(500)">NT$500</button>
        <button onclick="insert(1000)">NT$1000</button>
      </div>
    </div>

    <div class="product-section" id="productGrid">
      <div class="product" data-price="350" data-stock="5" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">5</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üéß</div>
        <div class="product-name">Noise-Cancelling Headphones</div>
        <div class="product-price">350 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="250" data-stock="6" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">6</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üîã</div>
        <div class="product-name">Portable Power Bank</div>
        <div class="product-price">250 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="150" data-stock="8" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">8</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üò¥</div>
        <div class="product-name">Luxury Eye Mask</div>
        <div class="product-price">150 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="200" data-stock="5" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">5</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üí§</div>
        <div class="product-name">Memory Foam Pillow</div>
        <div class="product-price">200 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="180" data-stock="7" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">7</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üîå</div>
        <div class="product-name">Premium Adapter</div>
        <div class="product-price">180 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="220" data-stock="4" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">4</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üëù</div>
        <div class="product-name">Neck Wallet</div>
        <div class="product-price">220 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="300" data-stock="3" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">3</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">ü©π</div>
        <div class="product-name">First Aid Kit Deluxe</div>
        <div class="product-price">300 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>

      <div class="product" data-price="270" data-stock="6" onclick="toggleSelect(this)">
        <div class="stock-badge">Stock: <span class="stock">6</span></div>
        <div class="soldout-overlay">SOLD OUT</div>
        <div class="product-icon">üß¥</div>
        <div class="product-name">Toiletry Bottles</div>
        <div class="product-price">270 NTD</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="qtyDown(event,this)">‚àí</button>
          <div class="qty-val">0</div>
          <button class="qty-btn" onclick="qtyUp(event,this)">+</button>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button onclick="confirmPurchase()">üßæ Confirm Purchase</button>
      <button onclick="returnChange()">üí∞ Return Change</button>
      <button onclick="resetMachine()">üîÑ Reset</button>
    </div>
  </div>

  <!-- Receipt panel -->
  <div class="modal-backdrop" id="receiptBackdrop" onclick="hideReceipt()">
    <div class="receipt" onclick="event.stopPropagation()">
      <header>
        <div class="title">üßæ Receipt</div>
        <button onclick="hideReceipt()">Close</button>
      </header>
      <div class="body">
        <div id="receiptItems" class="rows"></div>
        <div class="divider"></div>
        <div class="totals">
          <div class="row"><span>Total</span><strong id="receiptTotal">0</strong></div>
          <div class="row"><span>Balance After</span><strong id="receiptAfter">0</strong></div>
          <div class="row"><span>Change</span><strong id="receiptChange">0</strong></div>
        </div>
      </div>
    </div>
  </div>

<script>
  let balance = 0;
  let insertedCoins = [];

  const quotes = [
    "‚úàÔ∏è Your journey begins now!",
    "üåç Explore the world, one step at a time.",
    "üß≥ Travel light, live fully.",
    "üèñÔ∏è Collect moments, not things.",
    "üöÄ Ready for takeoff!"
  ];

  function currentTotal(){
    let total = 0;
    document.querySelectorAll(".product").forEach(card=>{
      const qty = parseInt(card.querySelector(".qty-val").textContent) || 0;
      const price = parseInt(card.dataset.price);
      total += qty * price;
    });
    return total;
  }

  function remaining(){
    return balance - currentTotal();
  }

  // ‚úÖ affordability glow uses remaining balance, not just raw balance
  function updateDisplay(){
    document.getElementById("balance").textContent = balance;
    document.getElementById("inserted-coins").textContent =
      insertedCoins.length ? "Inserted coins: " + insertedCoins.join(",") : "Inserted coins: 0";

    const total = currentTotal();
    const rem = remaining();

    document.getElementById("total").textContent = `Total Selected: ${total} NTD`;
    document.getElementById("remaining").textContent = `Remaining Balance: ${Math.max(0, rem)} NTD`;

    document.querySelectorAll(".product").forEach(card=>{
      const stock = parseInt(card.dataset.stock);
      const price = parseInt(card.dataset.price);
      const qty = parseInt(card.querySelector(".qty-val").textContent) || 0;

      // sold out
      if(stock <= 0){
        card.classList.add("soldout");
        card.classList.remove("enabled","affordable");
        card.querySelector(".qty-val").textContent = "0";
        card.classList.remove("selected");
      } else {
        card.classList.toggle("enabled", balance > 0);
      }

      // stock badge styling
      const badge = card.querySelector(".stock-badge");
      badge.classList.remove("low","zero");
      if(stock === 0) badge.classList.add("zero");
      else if(stock <= 2) badge.classList.add("low");
      card.querySelector(".stock").textContent = stock;

      // ‚úÖ glow if user can afford one more of this item with remaining coins
      // (don‚Äôt glow if it‚Äôs already selected; selected already has its own highlight)
      if(!card.classList.contains("soldout") && qty === 0 && balance > 0 && price <= rem){
        card.classList.add("affordable");
      } else {
        card.classList.remove("affordable");
      }
    });
  }

  function setMessage(msg){ document.getElementById("message").textContent = msg; }

  function showCenter(id, text, duration=1300){
    const el = document.getElementById(id);
    if(text) el.textContent = text;
    el.classList.remove("show");
    void el.offsetWidth;
    el.classList.add("show");
    setTimeout(()=> el.classList.remove("show"), duration);
  }

  function insert(amount){
    balance += amount;
    insertedCoins.push(`NT$${amount}`);
    setMessage(`ü™ô Inserted NT$${amount}. Balance: NT$${balance}`);
    updateDisplay();
  }

  function toggleSelect(card){
    if(card.classList.contains("soldout") || !card.classList.contains("enabled")) return;

    const qtyEl = card.querySelector(".qty-val");
    let qty = parseInt(qtyEl.textContent) || 0;
    const price = parseInt(card.dataset.price);

    if(qty === 0){
      if(remaining() - price < 0){
        showCenter("error-msg", "‚ö†Ô∏è Not enough balance!", 1200);
        setMessage("‚ö†Ô∏è Not enough balance for this item!");
        return;
      }
      qtyEl.textContent = "1";
      card.classList.add("selected");
    } else {
      qtyEl.textContent = "0";
      card.classList.remove("selected");
    }

    updateDisplay();
    setMessage("üõí Updated selection.");
  }

  function qtyUp(ev, btn){
    ev.stopPropagation();
    const card = btn.closest(".product");
    if(card.classList.contains("soldout") || !card.classList.contains("enabled")) return;

    const stock = parseInt(card.dataset.stock);
    const qtyEl = card.querySelector(".qty-val");
    let qty = parseInt(qtyEl.textContent) || 0;

    if(qty >= stock){
      showCenter("error-msg", "‚ö†Ô∏è No more stock!", 1200);
      setMessage("‚ö†Ô∏è Reached stock limit.");
      return;
    }

    const price = parseInt(card.dataset.price);
    if(remaining() - price < 0){
      showCenter("error-msg", "‚ö†Ô∏è Not enough balance!", 1200);
      setMessage("‚ö†Ô∏è Add more coins to increase quantity.");
      return;
    }

    qtyEl.textContent = String(qty + 1);
    card.classList.add("selected");
    updateDisplay();
  }

  function qtyDown(ev, btn){
    ev.stopPropagation();
    const card = btn.closest(".product");
    if(card.classList.contains("soldout") || !card.classList.contains("enabled")) return;

    const qtyEl = card.querySelector(".qty-val");
    let qty = parseInt(qtyEl.textContent) || 0;
    qty = Math.max(0, qty - 1);
    qtyEl.textContent = String(qty);

    if(qty === 0) card.classList.remove("selected");
    updateDisplay();
  }

  function confettiBurst(n=28){
    const w = window.innerWidth;
    for(let i=0;i<n;i++){
      const c = document.createElement("div");
      c.className = "confetti";
      c.style.left = Math.floor(Math.random()*w) + "px";
      c.style.animationDelay = (Math.random()*0.2) + "s";
      const hue = Math.floor(Math.random()*360);
      c.style.background = `hsl(${hue} 90% 60%)`;
      document.body.appendChild(c);
      setTimeout(()=>c.remove(), 1900);
    }
  }

  function showReceipt(items, total, after){
    const box = document.getElementById("receiptItems");
    box.innerHTML = items.map(it => `
      <div class="row">
        <span>${it.name} <small>√ó ${it.qty}</small></span>
        <span>${it.line} NTD</span>
      </div>
    `).join("");

    document.getElementById("receiptTotal").textContent = `${total} NTD`;
    document.getElementById("receiptAfter").textContent = `${after} NTD`;
    document.getElementById("receiptChange").textContent = `${after} NTD`;
    document.getElementById("receiptBackdrop").classList.add("show");
  }

  function hideReceipt(){
    document.getElementById("receiptBackdrop").classList.remove("show");
  }

  function confirmPurchase(){
    const items = [];
    document.querySelectorAll(".product").forEach(card=>{
      const qty = parseInt(card.querySelector(".qty-val").textContent) || 0;
      if(qty > 0){
        const price = parseInt(card.dataset.price);
        items.push({
          name: card.querySelector(".product-name").textContent,
          qty,
          line: qty * price,
          card
        });
      }
    });

    if(items.length === 0){
      showCenter("error-msg", "‚ö†Ô∏è Select an item!", 1200);
      setMessage("‚ö†Ô∏è Select at least one product!");
      return;
    }

    const total = currentTotal();
    if(total > balance){
      showCenter("error-msg", "‚ö†Ô∏è Not enough balance!", 1200);
      setMessage(`‚ö†Ô∏è Need NT$${total-balance} more.`);
      return;
    }

    balance -= total;

    items.forEach(it=>{
      const card = it.card;
      const newStock = Math.max(0, parseInt(card.dataset.stock) - it.qty);
      card.dataset.stock = newStock;
      card.querySelector(".qty-val").textContent = "0";
      card.classList.remove("selected");
    });

    showCenter("dispense-msg", "üéÅ Dispensing...", 1200);

    setTimeout(()=>{
      const quote = quotes[Math.floor(Math.random()*quotes.length)];
      setMessage(`üéâ Purchased ${items.length} item(s) for NT$${total}!\n${quote}`);
      showCenter("success-msg", "‚úÖ Done! Have a great trip ‚úàÔ∏è", 1400);
      confettiBurst(30);
      showReceipt(items, total, balance);
      updateDisplay();
    }, 750);
  }

  function returnChange(){
    if(balance <= 0){
      showCenter("error-msg", "‚ÑπÔ∏è No change to return", 1100);
      setMessage("‚ÑπÔ∏è Balance is already 0.");
      return;
    }
    const returned = balance;
    balance = 0;
    insertedCoins = [];
    setMessage(`üí∞ Returned NT$${returned} change. Insert coins to begin!`);
    showCenter("success-msg", `üí∞ Returned NT$${returned}`, 1400);

    document.querySelectorAll(".product").forEach(card=>{
      card.querySelector(".qty-val").textContent = "0";
      card.classList.remove("selected");
    });

    updateDisplay();
  }

  function resetMachine(){
    balance = 0;
    insertedCoins = [];
    setMessage("ü™ô Please insert coins to begin!");
    document.querySelectorAll(".product").forEach(card=>{
      card.querySelector(".qty-val").textContent = "0";
      card.classList.remove("selected");
    });
    updateDisplay();
  }

  updateDisplay();
</script>

</body>
</html>
